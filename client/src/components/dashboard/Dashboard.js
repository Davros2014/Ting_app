import React, { useEffect, useState } from "react";
import { toast } from "react-toastify";

import FormTodo from "./todolist/FormTodo";
import ListTodos from "./todolist/ListTodos";
import TingContainer from "../TingContainer";
import Navbar from "./Navbar";
// import ListSVG from "./dashboard/todolist/ListSVG";

//components

const Dashboard = ({ setAuth }) => {
  const [firstname, setFirstname] = useState("");
  const [allTodos, setAllTodos] = useState([]);
  const [todosChange, setTodosChange] = useState(false);

  const toggleComplete = async (id, completedState) => {
    try {
      const myHeaders = new Headers();
      myHeaders.append("Content-Type", "application/json");
      myHeaders.append("jwt_token", localStorage.token);
      // setAllTodos(
      //   allTodos.map(todo =>
      //     todo.todo_id === id ? { ...todo, completed: !todo.completed } : todo
      //   )
      // );
      const body = { completed: !completedState };
      const response = await fetch(`/api/dashboard/todos/completed/${id}`, {
        method: "PUT",
        headers: myHeaders,
        body: JSON.stringify(body)
      });
      const parseResponse = await response.json();
      setTodosChange(true);
    } catch (err) {
      console.error(err.message);
    }
  };

  const getProfile = async () => {
    try {
      const res = await fetch("/api/dashboard/", {
        method: "GET",
        headers: { jwt_token: localStorage.token }
      });
      const parseData = await res.json();
      setAllTodos(parseData);
      if (parseData[0].user_firstname)
        setFirstname(parseData[0].user_firstname);
    } catch (err) {
      console.error(err.message);
    }
  };

  const logout = async e => {
    e.preventDefault();
    try {
      localStorage.removeItem("token");
      setAuth(false);
      toast.success("Logout successfully", {
        position: toast.POSITION.BOTTOM_LEFT,
        className: "toastify-this"
      });
    } catch (err) {
      console.error(err.message);
    }
  };

  useEffect(() => {
    getProfile();
    setTodosChange(false);
  }, [todosChange]);
  return (
    <>
      <Navbar firstname={firstname} logout={logout} />
      <FormTodo setTodosChange={setTodosChange} />
      <TingContainer>
        {allTodos && allTodos.length > 0 ? (
          <ListTodos
            allTodos={allTodos}
            setTodosChange={setTodosChange}
            toggleComplete={toggleComplete}
          />
        ) : (
          <svg
            className="noTodosImg"
            version="1.1"
            id="Layer_1"
            xmlns="http://www.w3.org/2000/svg"
            x="0px"
            y="0px"
            viewBox="34.203 59.98 327.48 276.216"
            enableBackground="new 34.203 59.98 327.48 276.216"
          >
            <path
              id="BG"
              opacity="0.2"
              fill="#588A8E"
              d="M358.465,255.079c0-1.603,1.084-2.939,2.555-3.354
	    		c-0.244-1.384-0.552-2.745-0.925-4.079h-3.237c-1.933,0-3.5-1.567-3.5-3.5s1.567-3.5,3.5-3.5h0.59
	    		c-0.634-1.315-1.328-2.596-2.088-3.833h-39.546c-1.933,0-3.5-1.567-3.5-3.5s1.567-3.5,3.5-3.5h34.192
	    		c-1.06-1.125-2.176-2.194-3.35-3.2c4.483-8.824,7.027-18.8,7.027-29.375c0-20.683-9.672-39.099-24.735-50.992H296.21
	    		c-1.933,0-3.5-1.567-3.5-3.5s1.567-3.5,3.5-3.5h21.769c-2.915-1.473-5.953-2.738-9.1-3.764c-0.001-0.023-0.004-0.046-0.005-0.069
	    		h-1.253c-1.933,0-3.5-1.567-3.5-3.5s1.567-3.5,3.5-3.5h0.578c-0.203-1.459-0.437-2.91-0.718-4.343
	    		c-0.484,0.253-1.026,0.409-1.609,0.409h-1.75c-1.933,0-3.5-1.567-3.5-3.5s1.567-3.5,3.5-3.5h1.75c0.001,0,0.002,0,0.004,0
	    		c-9.544-33.202-40.123-57.5-76.396-57.5c-38.119,0-69.956,26.834-77.691,62.638c-6.797-3.108-14.346-4.854-22.309-4.854
	    		c-28.445,0-51.711,22.113-53.58,50.084c-13.312,0.794-24.982,7.682-32.257,17.913h35.649c1.933,0,3.5,1.567,3.5,3.5
	    		s-1.567,3.5-3.5,3.5H41.668c-0.667,0-1.285-0.197-1.815-0.521c-0.688,1.452-1.294,2.949-1.816,4.486
	    		c1.787,0.157,3.194,1.641,3.194,3.469c0,1.934-1.567,3.5-3.5,3.5h-1.42c-0.354,2.211-0.546,4.475-0.546,6.785
	    		c0,23.361,18.756,42.331,42.03,42.698c0.645,45.955,38.075,83.018,84.186,83.018c22.544,0,43.002-8.876,58.117-23.301
	    		c9.205,7.081,20.724,11.301,33.234,11.301c19.782,0,37.105-10.527,46.675-26.284c5.658,2.744,12.007,4.284,18.717,4.284
	    		c23.726,0,42.96-19.234,42.96-42.959c0-0.231-0.016-0.458-0.02-0.688C359.875,258.395,358.465,256.909,358.465,255.079z
	    		 M69.084,203.695H50.417c-1.933,0-3.5-1.566-3.5-3.5c0-1.933,1.567-3.5,3.5-3.5h18.667c1.933,0,3.5,1.567,3.5,3.5
	    		C72.584,202.129,71.017,203.695,69.084,203.695z M83.822,203.695h-4.968c-1.933,0-3.5-1.566-3.5-3.5c0-1.933,1.567-3.5,3.5-3.5
	    		h4.968c1.933,0,3.5,1.567,3.5,3.5C87.322,202.129,85.755,203.695,83.822,203.695z M85.856,189.262c0-1.933,1.567-3.5,3.5-3.5h3.358
	    		c1.933,0,3.5,1.567,3.5,3.5s-1.567,3.5-3.5,3.5h-3.358C87.424,192.762,85.856,191.195,85.856,189.262z M96.214,203.695h-1.75
	    		c-1.933,0-3.5-1.566-3.5-3.5c0-1.933,1.567-3.5,3.5-3.5h1.75c1.933,0,3.5,1.567,3.5,3.5
	    		C99.714,202.129,98.146,203.695,96.214,203.695z M110.355,192.762h-7c-1.933,0-3.5-1.567-3.5-3.5s1.567-3.5,3.5-3.5h7
	    		c1.933,0,3.5,1.567,3.5,3.5S112.288,192.762,110.355,192.762z M289.98,128.413h7c1.933,0,3.5,1.567,3.5,3.5s-1.567,3.5-3.5,3.5h-7
	    		c-1.933,0-3.5-1.567-3.5-3.5S288.048,128.413,289.98,128.413z M290.98,247.646c-1.933,0-3.5-1.567-3.5-3.5s1.567-3.5,3.5-3.5h55.813
	    		c1.933,0,3.5,1.567,3.5,3.5s-1.567,3.5-3.5,3.5H290.98z M340.085,255.079c0,1.933-1.567,3.5-3.5,3.5h-18.667
	    		c-1.933,0-3.5-1.567-3.5-3.5s1.567-3.5,3.5-3.5h18.667C338.518,251.579,340.085,253.146,340.085,255.079z M303.481,258.579
	    		c-1.933,0-3.5-1.567-3.5-3.5s1.567-3.5,3.5-3.5h1.75c1.933,0,3.5,1.567,3.5,3.5s-1.567,3.5-3.5,3.5H303.481z M325.313,270.146h-15
	    		c-1.933,0-3.5-1.567-3.5-3.5s1.567-3.5,3.5-3.5h15c1.933,0,3.5,1.567,3.5,3.5S327.246,270.146,325.313,270.146z M338.646,270.146
	    		h-1.75c-1.933,0-3.5-1.567-3.5-3.5s1.567-3.5,3.5-3.5h1.75c1.933,0,3.5,1.567,3.5,3.5S340.579,270.146,338.646,270.146z
	    		 M351.323,258.579h-4.968c-1.933,0-3.5-1.567-3.5-3.5s1.567-3.5,3.5-3.5h4.968c1.933,0,3.5,1.567,3.5,3.5
	    		S353.256,258.579,351.323,258.579z"
            />
            <line
              display="none"
              fill="#FFFFFF"
              stroke="#588A8E"
              strokeWidth="8"
              strokeLinecap="round"
              strokeLinejoin="round"
              strokeMiterlimit="10"
              x1="218.979"
              y1="159.647"
              x2="250.619"
              y2="159.647"
            />
            <path
              id="white_x5F_bg"
              fill="#FFFFFF"
              d="M259.979,105.98H139.312c-2.757,0-5,2.243-5,5v145.358
	    		c-0.341-0.023-0.681-0.05-1.028-0.05c-1.537,0-3.07,0.246-4.557,0.731c-1.058,0.347-2.212,0.235-3.185-0.305
	    		c-0.973-0.541-1.676-1.462-1.942-2.543c-2.274-9.254-10.526-15.718-20.067-15.718c-9.629,0-18.115,6.817-20.179,16.21
	    		c-0.28,1.276-1.166,2.335-2.373,2.836c-1.208,0.503-2.582,0.38-3.684-0.321c-1.137-0.725-2.445-1.107-3.782-1.107
	    		c-3.895,0-7.063,3.169-7.063,7.063c0,0.486,0.053,0.981,0.156,1.471c0.274,1.295-0.109,2.641-1.024,3.596
	    		c-0.915,0.956-2.246,1.399-3.548,1.179c-1.041-0.174-1.968-0.259-2.834-0.259c-9.374,0-16.999,7.626-16.999,16.999
	    		c0,9.374,7.625,17,16.999,17h96.999c8.087,0,14.667-6.579,14.667-14.667c0-3.456-1.209-6.631-3.216-9.141h92.328
	    		c2.757,0,5-2.243,5-5V110.98C264.979,108.224,262.736,105.98,259.979,105.98z"
            />
            <path
              id="green_x5F_elements"
              fill="#588A8E"
              d="M191.993,163.647h13.986c2.209,0,4-1.791,4-4s-1.791-4-4-4h-13.986
	    		c-2.209,0-4,1.791-4,4S189.784,163.647,191.993,163.647z M168.127,224.309l-10.268,10.269l-3.155-3.154
	    		c-0.953-0.953-2.497-0.953-3.45,0c-0.953,0.952-0.952,2.497,0,3.449l4.88,4.879c0.476,0.477,1.101,0.715,1.725,0.715
	    		s1.249-0.238,1.725-0.715l11.993-11.993c0.953-0.952,0.953-2.497,0-3.449C170.625,223.355,169.081,223.355,168.127,224.309z
	    		 M156.135,202.561c0.476,0.477,1.101,0.715,1.725,0.715s1.249-0.238,1.725-0.715l11.993-11.994c0.953-0.953,0.953-2.497,0-3.45
	    		c-0.952-0.952-2.497-0.953-3.45,0l-10.268,10.269l-3.155-3.154c-0.953-0.953-2.497-0.952-3.45,0s-0.952,2.497,0,3.45
	    		L156.135,202.561z M156.135,165.371c0.476,0.476,1.101,0.714,1.725,0.714s1.249-0.238,1.725-0.715l11.993-11.994
	    		c0.953-0.953,0.953-2.497,0-3.45c-0.952-0.952-2.497-0.953-3.45,0l-10.268,10.269l-3.155-3.154c-0.953-0.952-2.497-0.953-3.45,0
	    		c-0.953,0.953-0.952,2.497,0,3.45L156.135,165.371z M232.48,230.028h-12.751c-2.209,0-4,1.791-4,4s1.791,4,4,4h12.751
	    		c2.209,0,4-1.791,4-4S234.689,230.028,232.48,230.028z M250.619,155.647h-31.64c-2.209,0-4,1.791-4,4s1.791,4,4,4h31.64
	    		c2.209,0,4-1.791,4-4S252.828,155.647,250.619,155.647z M191.993,200.838h24.319c2.209,0,4-1.791,4-4s-1.791-4-4-4h-24.319
	    		c-2.209,0-4,1.791-4,4S189.784,200.838,191.993,200.838z M259.979,97.98H139.312c-7.168,0-13,5.832-13,13v130.735
	    		c-5.289-6.933-13.597-11.261-22.778-11.261c-11.77,0-22.31,7.346-26.607,18.01c-1.112-0.26-2.256-0.393-3.41-0.393
	    		c-7.626,0-13.947,5.696-14.931,13.058c-13.5,0.328-24.383,11.413-24.383,24.991c0,13.785,11.214,25,24.999,25h96.999
	    		c12.499,0,22.667-10.168,22.667-22.667c0-0.383-0.01-0.763-0.029-1.141h81.14c7.168,0,13-5.832,13-13V110.98
	    		C272.979,103.812,267.147,97.98,259.979,97.98z M156.201,303.121H59.202c-9.374,0-16.999-7.626-16.999-17
	    		c0-9.373,7.625-16.999,16.999-16.999c0.866,0,1.793,0.085,2.834,0.259c1.302,0.221,2.633-0.223,3.548-1.179
	    		c0.915-0.955,1.299-2.301,1.024-3.596c-0.104-0.489-0.156-0.984-0.156-1.471c0-3.895,3.168-7.063,7.063-7.063
	    		c1.337,0,2.645,0.383,3.782,1.107c1.102,0.701,2.476,0.824,3.684,0.321c1.207-0.501,2.092-1.56,2.373-2.836
	    		c2.064-9.393,10.55-16.21,20.179-16.21c9.541,0,17.792,6.464,20.067,15.718c0.266,1.081,0.969,2.002,1.942,2.543
	    		c0.248,0.138,0.507,0.246,0.774,0.327c0.229,0.07,0.464,0.112,0.701,0.141c0.078,0.009,0.155,0.012,0.234,0.016
	    		c0.176,0.011,0.351,0.01,0.527-0.003c0.075-0.006,0.15-0.009,0.226-0.02c0.244-0.031,0.486-0.078,0.724-0.156
	    		c1.486-0.485,3.02-0.731,4.557-0.731c7.019,0,12.852,4.87,14.294,11.488c-1.42,0.703-3.144,1.714-4.829,3.109
	    		c-1.701,1.409-1.938,3.931-0.529,5.632c0.791,0.955,1.933,1.448,3.083,1.448c0.898,0,1.803-0.302,2.549-0.92
	    		c2.139-1.771,4.488-2.661,5.089-2.871c1.125-0.257,2.193-0.388,3.259-0.388c4.643,0,8.78,2.175,11.47,5.551
	    		c0.38,0.478,0.726,0.983,1.045,1.507c0.065,0.105,0.132,0.21,0.194,0.318c0.137,0.237,0.265,0.479,0.388,0.725
	    		c0.055,0.11,0.108,0.222,0.161,0.333c0.124,0.263,0.246,0.527,0.354,0.798c0,0.001,0,0.001,0,0.002
	    		c0.256,0.641,0.464,1.305,0.629,1.985c0.01,0.042,0.022,0.083,0.032,0.125c0.072,0.311,0.131,0.626,0.183,0.943
	    		c0.014,0.085,0.027,0.17,0.039,0.255c0.047,0.324,0.088,0.65,0.114,0.98c0.03,0.379,0.058,0.758,0.058,1.144
	    		C170.868,296.542,164.289,303.121,156.201,303.121z M264.979,274.313c0,2.757-2.243,5-5,5h-83.043
	    		c-3.522-7.957-11.488-13.525-20.735-13.525c-0.283,0-0.567,0.006-0.853,0.018c-2.243-9.784-10.729-17.016-21.036-17.473V110.98
	    		c0-2.757,2.243-5,5-5h120.667c2.757,0,5,2.243,5,5V274.313z M246.48,192.838h-16.998c-2.209,0-4,1.791-4,4s1.791,4,4,4h16.998
	    		c2.209,0,4-1.791,4-4S248.689,192.838,246.48,192.838z M206.48,230.028h-14.487c-2.209,0-4,1.791-4,4s1.791,4,4,4h14.487
	    		c2.209,0,4-1.791,4-4S208.689,230.028,206.48,230.028z"
            />
          </svg>
        )}
      </TingContainer>
    </>
  );
};

export default Dashboard;
